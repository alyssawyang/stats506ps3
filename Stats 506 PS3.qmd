---
title: "Stats 506 PS3"
author: "Alyssa Yang"
format: html
---

GitHub repo link: https://github.com/alyssawyang/stats506ps3

# Problem 1 - Vision
## 1a
```{r}
#| code-fold: true
library(knitr)
library(haven)

# Read in files
vix <- read_xpt("VIX_D.XPT")
demo <- read_xpt("DEMO_D.XPT")

# Merge the two datasets
vision <- data.frame(merge(vix, demo, by = "SEQN"))

# Print total sample size - should be 6980
cat("Total sample size: ", nrow(vision))
```


## 1b
```{r}
# VIQ220 - Glasses/contact lenses worn for distance
# RIDAGEMN - Age in Years

# Rename variable columns
colnames(vision)[colnames(vision) == "VIQ220"] <- "glasses"
colnames(vision)[colnames(vision) == "RIDAGEYR"] <- "age"

vision[vision == "."] <- NA

# Redefine glasses variable
vision$glasses[vision$glasses == 1] <- 0
vision$glasses[vision$glasses == 2] <- 1
vision$glasses[vision$glasses == 9] <- NA

# Remove all NA values for these two variables
vision <- vision[!is.na(vision$age), ]
vision <- vision[!is.na(vision$glasses), ]
```

```{r}
# Convert age in months into age brackets of 10 years
vision$age_brackets <- cut(vision$age, breaks = seq(0, 90, by = 10), right = FALSE, 
                           labels = c("0-9", "10-19", "20-29", "30-39", "40-49", 
                                      "50-59", "60-69", "70-79", "80-89"))

# Compute proportions for each age bracket
proportions <- aggregate(glasses ~ age_brackets, data = vision, FUN = mean)
print(proportions)
colnames(proportions) <- c("Age Bracket", "Proportion Wearing Glasses/Contacts")

# Create table of proportions
# kable(proportions, caption = "Proportion of Respondents Wearing Glasses/Contacts by Age Bracket")
```


## 1c
```{r}
# RIDRETH1 - Race/Ethnicity
# RIAGENDR - Gender
# INDFMPIR - Family Poverty Income Ratio

library(pscl) # For Pseudo-R^2 function

# Rename variable columns
colnames(vision)[colnames(vision) == "RIDRETH1"] <- "race"
colnames(vision)[colnames(vision) == "RIAGENDR"] <- "gender"
colnames(vision)[colnames(vision) == "INDFMPIR"] <- "pir"

# Convert race and gender to factors
vision$race <- as.factor(vision$race)
vision$gender <- as.factor(vision$gender)

# Rename levels of race and gender
levels(vision$race) <- c("Mexican American", "Other Hispanic", "Non-Hispanic White", "Non-Hispanic Black",
                         "Other Race - Including Multi-Racial")
levels(vision$gender) <- c("Male", "Female")
```

```{r}
# Model 1
model1 <- glm(glasses ~ age, data = vision, family = "binomial")
```

```{r}
# Remove all NA values for race and gender
vision <- vision[!is.na(vision$race), ]
vision <- vision[!is.na(vision$gender), ]

# Model 2
model2 <- glm(glasses ~ age + race + gender, data = vision, family = "binomial")
```

```{r}
# Remove NA values for pir
vision <- vision[!is.na(vision$pir), ]

# Model 3
model3 <- glm(glasses ~ age + race + gender + pir, data = vision, family = "binomial")

```


```{r}
# Create list of models and model names
models = list(model1, model2, model3)
model_names <- c("Model 1 (Age)", "Model 2 (Age, Race, Gender)", "Model 3 (Age, Race, Gender, Poverty Income Ratio)")

# Iterate through models and create summary table for each
for (i in 1:3) {
  model <- models[[i]]
  
  # Find values for the table
  odds <- exp(coef(model)) # Convert coefficients from log-odds to odds-ratios
  size <- length(model$fitted.values) # Find sample size
  pseudo_r2_output <- capture.output(pseudo_r2 <- pR2(model)) # Suppress output of pR2
  pseudo_r2_value <- pseudo_r2["McFadden"] # Find pseudo R^2 value
  aic <- AIC(model) # Find AIC
  
  # Create summary table
  results <- data.frame(Odds_Ratios = odds)
  print(results)
  cat("size: ", size, "pseudo_r^2: ", pseudo_r2, "aic: ", aic)
}
# print(results)
# kable(results, caption = "Summary of Logistic Regression Models")
```














