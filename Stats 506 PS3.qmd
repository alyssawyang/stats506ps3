---
title: "Stats 506 PS3"
author: "Alyssa Yang"
format: html
---

GitHub repo link: https://github.com/alyssawyang/stats506ps3

# Problem 1 - Vision
## 1a
```{r}
#| code-fold: true
library(knitr)
library(haven)

# Read in files
vix <- read_xpt("VIX_D.XPT")
demo <- read_xpt("DEMO_D.XPT")

# Merge the two datasets
vision <- data.frame(merge(vix, demo, by = "SEQN"))

# Print total sample size - should be 6980
cat("Total sample size: ", nrow(vision))
```


## 1b
```{r}
#| code-fold: true
# VIQ220 - Glasses/contact lenses worn for distance
# RIDAGEMN - Age in Years

# Rename variable columns
colnames(vision)[colnames(vision) == "VIQ220"] <- "glasses"
colnames(vision)[colnames(vision) == "RIDAGEYR"] <- "age"

# Replace all missing values with NA
vision[vision == "."] <- NA

# Redefine glasses variable
vision$glasses[vision$glasses == 1] <- 0
vision$glasses[vision$glasses == 2] <- 1
vision$glasses[vision$glasses == 9] <- NA

# Remove all NA values for these two variables
vision <- vision[!is.na(vision$age), ]
vision <- vision[!is.na(vision$glasses), ]
```

```{r}
#| code-fold: true
# Convert age in months into age brackets of 10 years
vision$age_brackets <- cut(vision$age, breaks = seq(0, 90, by = 10), right = FALSE, 
                           labels = c("0-9", "10-19", "20-29", "30-39", "40-49", 
                                      "50-59", "60-69", "70-79", "80-89"))

# Compute proportions for each age bracket
proportions <- aggregate(glasses ~ age_brackets, data = vision, FUN = mean)
colnames(proportions) <- c("Age Bracket", "Proportion Wearing Glasses/Contacts")

# Create table of proportions
kable(proportions, caption = "Proportion of Respondents Wearing Glasses/Contacts by Age Bracket")
```


## 1c
```{r}
#| code-fold: true
# RIDRETH1 - Race/Ethnicity
# RIAGENDR - Gender
# INDFMPIR - Family Poverty Income Ratio

suppressMessages(library(pscl)) # For Pseudo-R^2 function

# Rename variable columns
colnames(vision)[colnames(vision) == "RIDRETH1"] <- "race"
colnames(vision)[colnames(vision) == "RIAGENDR"] <- "gender"
colnames(vision)[colnames(vision) == "INDFMPIR"] <- "pir"

# Convert race and gender to factors
vision$race <- as.factor(vision$race)
vision$gender <- as.factor(vision$gender)

# Rename levels of race and gender
levels(vision$race) <- c("Mexican American", "Other Hispanic", "Non-Hispanic White", "Non-Hispanic Black",
                         "Other Race - Including Multi-Racial")
levels(vision$gender) <- c("Male", "Female")
```

```{r}
#| code-fold: true
# Model 1
model1 <- glm(glasses ~ age, data = vision, family = "binomial")

# Find values for the table
odds1 <- exp(coef(model1)) # Convert coefficients from log-odds to odds-ratios
size1 <- length(model1$fitted.values) # Find sample size
pseudo_r2_output <- capture.output(pseudo_r2_1 <- pR2(model1)) # Suppress output of pR2
pseudo_r2_1 <- pseudo_r2_1["McFadden"] # Find pseudo R^2 value
aic1 <- AIC(model1) # Find AIC
```

```{r}
#| code-fold: true
# Remove all NA values for race and gender
vision <- vision[!is.na(vision$race), ]
vision <- vision[!is.na(vision$gender), ]

# Model 2
model2 <- glm(glasses ~ age + race + gender, data = vision, family = "binomial")

# Find values for the table
odds2 <- exp(coef(model2)) # Convert coefficients from log-odds to odds-ratios
size2 <- length(model2$fitted.values) # Find sample size
pseudo_r2_output <- capture.output(pseudo_r2_2 <- pR2(model2)) # Suppress output of pR2
pseudo_r2_2 <- pseudo_r2_2["McFadden"] # Find pseudo R^2 value
aic2 <- AIC(model2) # Find AIC
```

```{r}
#| code-fold: true
# Remove NA values for pir
vision <- vision[!is.na(vision$pir), ]

# Model 3
model3 <- glm(glasses ~ age + race + gender + pir, data = vision, family = "binomial")

# Find values for the table
odds3 <- exp(coef(model3)) # Convert coefficients from log-odds to odds-ratios
size3 <- length(model3$fitted.values) # Find sample size
pseudo_r2_output <- capture.output(pseudo_r2_3 <- pR2(model3)) # Suppress output of pR2
pseudo_r2_3 <- pseudo_r2_3["McFadden"] # Find pseudo R^2 value
aic3 <- AIC(model3) # Find AIC
```

```{r}
#| code-fold: true
# Find the maximum length of the variable names from all models
max_length <- max(length(names(odds1)), length(names(odds2)), length(names(odds3)))

# Create list of variable names
var_names <- c("(Intercept)", "Age", "Other Hispanic", "Non-Hispanic White", "Non-Hispanic Black",
               "Other Race - Including Multi-racial", "Female", "Poverty Income Ratio")

# Create a data frame with the odds ratios
odds <- data.frame(
  Variable = var_names,
  Model1 = c(odds1, rep(NA, max_length - length(odds1))),
  Model2 = c(odds2, rep(NA, max_length - length(odds2))),
  Model3 = odds3
)

# Create a data frame with the statistics
stats <- data.frame(
  Variable = c("Sample Size", "Pseudo RÂ²", "AIC"),
  Model1 = c(size1, pseudo_r2_1, aic1),
  Model2 = c(size2, pseudo_r2_2, aic2),
  Model3 = c(size3, pseudo_r2_3, aic3)
)

# Create a separator data frame
separator_row <- data.frame(
  Variable = "-",
  Model1 = "-",
  Model2 = "-",
  Model3 = "-"
)

# Combine data frames together
results <- rbind(odds, separator_row, stats)

# Create the table using kable
kable(results, caption = "Summary of Logistic Regression Models", row.names = FALSE,
      col.names = c("Variable", "Model 1", "Model 2", "Model 3"))
```

















